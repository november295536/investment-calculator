# 投資進場計算器 - 使用指南

這個工具可以幫助您計算在市場下跌過程中的分批進場策略，採用「先少後多」的資金配置方式，讓您在市場初期下跌時投入較少資金，隨著下跌幅度增加，逐漸增加投入金額。

## 目錄

1. [環境設置](#環境設置)
2. [參數說明](#參數說明)
3. [使用方法](#使用方法)
4. [輸出結果解釋](#輸出結果解釋)
5. [配置文件格式](#配置文件格式)
6. [常見問題](#常見問題)

## 環境設置

### 基本需求

- Python 3.6 或更高版本
- pip (Python 套件管理工具)

### 步驟 1: 下載程式碼

將 `investment_calculator.py` 檔案下載到您的電腦上。

### 步驟 2: 建立虛擬環境

虛擬環境可以讓您的專案擁有獨立的依賴套件，避免與系統其他 Python 專案衝突。

**使用 venv (Python 內建工具):**

```bash
# 在程式所在的目錄中打開終端/命令提示符
# Windows
python -m venv investment-env

# macOS/Linux
python3 -m venv investment-env
```

### 步驟 3: 啟動虛擬環境

```bash
# Windows
investment-env\Scripts\activate

# macOS/Linux
source investment-env/bin/activate
```

啟動後，您的命令提示符前應該會出現 `(investment-env)` 標記。

### 步驟 4: 安裝依賴套件

```bash
pip install tabulate
```

## 參數說明

投資進場計算器需要以下幾個關鍵參數，它們的含義和影響如下：

### 1. 標的名稱

- **說明**：投資標的的識別名稱，如 VTI、AAPL 等
- **用途**：純粹用於識別和區分不同的投資標的
- **範例**：`VTI`

### 2. 可投入資金

- **說明**：您為這個投資標的準備的總資金額
- **用途**：決定整個投資計劃的預算規模
- **範例**：`10000` (表示 10,000 元)
- **注意**：不要使用貨幣符號或千分位逗號，直接輸入數字

### 3. 當前價格

- **說明**：投資標的的目前市場價格
- **用途**：作為計算所有進場點價格的基準
- **範例**：`248` (表示價格為 248 元)
- **注意**：輸入當前的實際市場價格，不含任何費用或稅金

### 4. 預測最大下跌百分比

- **說明**：您預期市場可能下跌的最大幅度
- **用途**：決定您的投資計劃涵蓋的價格範圍下限
- **範例**：`40` (表示預期最多下跌 40%)
- **重要性**：這是您策略的關鍵參數，過大會導致資金過度分散，過小則可能無法充分利用較深的回調
- **建議**：根據歷史數據和市場狀況謹慎選擇，一般熊市可考慮 30-50%

### 5. 進場間隔百分比

- **說明**：每隔多少百分比的下跌設定一個買點
- **用途**：決定您的買點密度和總買點數量
- **範例**：`5` (表示每下跌 5% 設定一個買點)
- **影響**：較小的間隔會產生更多買點和更細緻的資金分配，但也可能導致單次交易金額較小
- **建議**：一般設定在 3% 到 10% 之間，視投資金額大小和交易成本而定

### 6. 加速因子

- **說明**：控制資金分配的非線性程度，影響「先少後多」策略的傾斜程度
- **用途**：決定資金如何在不同進場點之間分配
- **範例**：`1.5` (適中的非線性分配)
- **數值含義**：
  - `0.0`：線性分配，每個進場點的資金比例基本均勻
  - `1.5`：適中的非線性分配，後期進場點的資金比例明顯高於前期
  - `2.0`：強烈的非線性分配，資金高度集中在後期進場點
  - `3.0`：極端的非線性分配，幾乎所有資金都集中在最後幾個進場點
- **重要性**：這是決定您投資策略風險和潛在收益特性的核心參數
- **建議**：
  - 對風險承受能力強，且認為市場可能大幅回調的投資者，可選擇較高的加速因子 (2.0-3.0)
  - 對於希望更平衡配置資金的投資者，建議使用中等加速因子 (1.3-1.7)
  - 若希望更均勻地配置資金，可選擇接近 1.0 的加速因子

#### 加速因子的計算設計

加速因子的計算是本工具的核心創新，這裡詳細解釋其工作原理：

1. **基本原理**：
   使用冪函數來創建非線性的資金分配曲線，加速因子作為指數值控制曲線的陡峭程度。

2. **計算公式**：
   ```
   權重 = (1 + i / (總進場點數 - 1)) ^ 加速因子
   ```
   其中:
   - i 是進場點的索引 (從 0 開始)
   - 基礎項 `1 + i / (總進場點數 - 1)` 在 1 到 2 之間線性增長
   - 加速因子作為指數，控制最終權重的非線性程度

3. **實際效果** (假設8個進場點)：

   | 加速因子 | 首次進場資金 | 中間進場資金 | 最終進場資金 | 最後/首次比例 |
   |---------|------------|------------|------------|-------------|
   | 0.0     | ~12.5%     | ~12.5%     | ~12.5%     | ~1倍        |
   | 1.0     | ~7.7%      | ~10.3%     | ~15.4%     | ~2倍        |
   | 1.5     | ~6.7%      | ~11.4%     | ~18.9%     | ~2.8倍      |
   | 2.0     | ~5.6%      | ~12.5%     | ~22.4%     | ~4倍        |
   | 3.0     | ~3.8%      | ~14.5%     | ~29.0%     | ~7.6倍      |

4. **優勢**：
   - 簡單性：只需調整一個參數即可控制整個資金分配策略
   - 彈性：可實現從接近均勻分配到極度後期集中的多種策略
   - 符合市場心理學：隨著市場下跌幅度加大，逐步加大買入力度

## 使用方法

### 互動模式

最簡單的使用方式是通過互動模式：

```bash
python investment_calculator.py --interactive
```

程式會引導您：
1. 輸入投資標的資訊
2. 查看計算結果
3. 選擇是否導出數據

### 使用配置文件

您也可以通過 JSON 配置文件來批量設定投資標的：

```bash
python investment_calculator.py --config config.json
```

### 使用時間戳導出結果

若要將結果以時間戳命名的 JSON 文件導出：

```bash
python investment_calculator.py --config config.json --timestamp
```

## 輸出結果解釋

程式會產生一個表格，包含以下欄位：

- **Entry No.**：第幾次進場
- **Drop %**：相對於當前價格的下跌百分比
- **Entry Price**：該進場點的具體價格
- **Inv. Amount**：該進場點投入的資金量
- **Weight %**：該進場點使用的總資金百分比
- **Cum. Inv.**：累計投入資金，顯示截至該進場點總共投入的金額
- **Cum. Weight %**：累計投入資金百分比，顯示截至該進場點已投入資金佔總可投入資金的百分比
- **Shares**：按該價格可購買的股數（四捨五入到小數點後兩位）

### 範例輸出

```
標的: VTI
當前價格: 248
可投入資金: 10000
預測最大下跌: 40%
進場間隔: 5%
加速因子: 1.5

+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
| Entry No.  |     Drop %    |  Entry Price  |  Inv. Amount  |   Weight %    |   Cum. Inv.   | Cum. Weight %   |   Shares   |
+============+===============+===============+===============+===============+===============+=================+============+
|     1      |     5.00%     |    235.60     |    668.41     |     6.68%     |    668.41     |      6.68%      |    2.84    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
|     2      |    10.00%     |    223.20     |    816.64     |     8.17%     |   1485.05     |     14.85%      |    3.66    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
|     3      |    15.00%     |    210.80     |    974.46     |     9.74%     |   2459.51     |     24.60%      |    4.62    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
|     4      |    20.00%     |    198.40     |    1141.30    |    11.41%     |   3600.81     |     36.01%      |    5.75    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
|     5      |    25.00%     |    186.00     |    1316.70    |    13.17%     |   4917.51     |     49.18%      |    7.08    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
|     6      |    30.00%     |    173.60     |    1500.27    |    15.00%     |   6417.78     |     64.18%      |    8.64    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
|     7      |    35.00%     |    161.20     |    1691.66    |    16.92%     |   8109.44     |     81.09%      |   10.49    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+
|     8      |    40.00%     |    148.80     |    1890.56    |    18.91%     |  10000.00     |    100.00%      |   12.71    |
+------------+---------------+---------------+---------------+---------------+---------------+-----------------+------------+

總投入資金: 10000.00
總購買股數: 55.79
```

## 配置文件格式

若要使用配置文件，請按以下 JSON 格式創建：

```json
{
  "assets": [
    {
      "name": "VTI",
      "available_funds": "10000",
      "current_price": "248",
      "max_drop_percentage": "40",
      "entry_interval": "5",
      "acceleration_factor": "1.5"
    },
    {
      "name": "AAPL",
      "available_funds": "5000",
      "current_price": "169.5",
      "max_drop_percentage": "30",
      "entry_interval": "5",
      "acceleration_factor": "2.0"
    }
  ]
}
```

## 常見問題

### 如何選擇最佳的加速因子？

加速因子影響資金在不同進場點的分配。一個簡單的方法是根據您對市場下跌深度的信心來選擇：
- 如果您非常確信市場會大幅下跌，可以選擇較高的加速因子 (2.0-3.0)
- 如果不太確定下跌深度，建議使用中等加速因子 (1.3-1.7)
- 如果希望更平均地分配風險，可選擇接近 1.0 的加速因子

選擇加速因子時可以考慮以下因素：
- **市場週期**：在明顯的熊市初期，較高的加速因子可能更有效
- **波動性**：高波動性市場可能需要較低的加速因子以避免資金過度集中
- **風險承受度**：個人風險偏好應該影響加速因子的選擇
- **預期的下跌模式**：如果預期是快速暴跌，可用較低的加速因子；如果預期是緩慢下跌，可用較高的加速因子

### 計算結果顯示小數股數，如何處理？

對於不支持購買零股的證券，您可以：
1. 向下取整到可交易的股數
2. 累積多個進場點的資金，直到達到整數股
3. 根據經紀商的規則進行調整

### 程式出現錯誤該怎麼辦？

常見錯誤通常與輸入格式有關。請確保：
1. 數字輸入不包含貨幣符號或逗號
2. 所有必填欄位都已提供值
3. 配置文件的 JSON 格式正確

### 如何修改已設定的投資標的？

在互動模式下，目前不支持直接修改已添加的標的。建議：
1. 重新啟動程式並添加新的標的
2. 或者編輯配置文件後通過 `--config` 選項載入

### 我應該如何設定"預測最大下跌百分比"？

這應基於：
1. 歷史數據分析（過往熊市的平均跌幅）
2. 當前市場估值水平
3. 宏觀經濟狀況
4. 您對市場的個人研判

一般來說，正常熊市可考慮 30-40%，嚴重衰退或重大危機可考慮 40-50%。

### 進場間隔應該設定多大？

這取決於：
1. 您的總投資金額（金額越大，間隔可以越小）
2. 交易成本（手續費高時，不宜設定太小的間隔）
3. 市場波動特性（波動大的市場可設定略大的間隔）

一般建議初學者從 5% 開始，然後根據實際情況調整。

### 這個工具是否考慮了交易成本？

本工具目前不考慮交易成本（如手續費、稅金等）。在實際執行時，您需要自己考慮這些因素：
1. 可以略微減少每個進場點的投入金額，為交易成本預留空間
2. 對於手續費較高的情況，可考慮增加進場間隔，減少總交易次數
3. 某些券商提供免手續費交易，這種情況下可設置較小的進場間隔
